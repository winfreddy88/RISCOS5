/* Copyright 1998 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* -*-C-*-
 *
 * Copyright (C) Acorn Computers Ltd.  1996, 1997, 1998
 *
 * Handler for SWI URL_Status
 */

#include <stdio.h>
#include "swis.h"
#include "url.h"
#include "protocol.h"
#include "utils.h"
#include "externs.h"

_kernel_oserror *status(_kernel_swi_regs *r)
{
    	unsigned int _swi_;
    	Client *list = find_client(r->r[1]);

    	/* Return an error if we arent registered */
    	if (list == NULL) {
      		return make_error(url_ERROR_CLIENT_ID_NOT_FOUND, 0);
	}

    	_swi_ = list->client.protocol;

    	/* get status information */
    	if (_swi_== 0) {
      		if( list->client.had_connection != 0) {
        		r->r[0]=list->client.had_connection;
                }
      		else {
        		r->r[0]=0;
                }
      		r->r[1]=0;
      		r->r[2]=0;
      		return NULL;
        }

    	return directswi_call(_swi_+1,r,r);
}


