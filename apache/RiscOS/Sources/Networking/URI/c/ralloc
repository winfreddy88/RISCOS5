/* Copyright 1998 Acorn Computers Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* -*-C-*-
 *
 * $Header: /home/rool/cvsroot/apache/RiscOS/Sources/Networking/URI/c/ralloc,v 1.2 2000/04/14 10:40:28 sbrodie Exp $
 * $Source: /home/rool/cvsroot/apache/RiscOS/Sources/Networking/URI/c/ralloc,v $
 *
 * Copyright(c) 1995 Acorn Computers Ltd., Cambridge, England
 *
 * $Log: ralloc,v $
 * Revision 1.2  2000/04/14 10:40:28  sbrodie
 *   Intermediate attempt to support ANT's URL protocol.
 * Admin:
 *   Not compiled, not tested, don't use.
 *
 * Revision 1.2  95/01/09  13:44:28  kwelton
 * The header file _swis.h no longer exists, it has been adsorbed into the
 * (new) system version of swis.h.
 *
 * Revision 1.1  95/01/04  09:57:03  kwelton
 * Initial revision
 *
 */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "kernel.h"
#include "swis.h"

#define NORALLOCDEFINES
#include "ralloc.h"
#include "globals.h"

int do_not_mix_debugging_ralloc = 0;

#define size(b)		(((int *)b)[-1] - 4)	/* Gives size of block */

void *rmalloc(size_t size)
{
    void *p;
    _kernel_oserror *err;

    err = _swix(OS_Module, _IN(0) | _IN(3) | _OUT(2), 6, size, &p);
    if (err)
	return NULL;
    return p;
}

void rfree(void *p)
{
     _swix(OS_Module, _IN(0) | _IN(2), 7, p);
}

void *rrealloc(void *p, size_t size)
{
    _kernel_oserror *err;
    if (!p)
	return rmalloc(size);
    err = _swix(OS_Module, _IN(0) | _IN(2) | _IN(3) | _OUT(2),
		13, p, size - size(p), &p);
    if (err)
	return NULL;
    return p;
}

void *rcalloc(size_t n, size_t m)
{
    void *p = rmalloc(n * m);
    if (p)
	memset(p, 0, (size_t) (n * m));
    return p;
}

char *rstrdup(const char *s)
{
    char *p;
    int l = strlen(s);
    p = rmalloc(l + 1);
    if (p)
	strcpy(p, s);
    return p;
}

/* EOF ralloc.c */
