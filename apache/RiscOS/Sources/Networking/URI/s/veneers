; Copyright 2000 Pace Micro Technology plc
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;
; File		: veneer.s
; Purpose	: Veneers to call URI handler SWIs from C
; Author	: Ben Laughton
; History	: 17/04/1997

	GET	hdr:ListOpts
	GET	hdr:Macros
	GET	hdr:System

	GET	hdr.URI

	AREA	|C$$code|, CODE, READONLY

	EXPORT	|uri_version|
	EXPORT	|uri_dispatch|
	EXPORT	|uri_request_uri|
	EXPORT	|uri_invalidate_uri|

|uri_version|
	Push	"lr"
	SWI	XURI_Version
	Pull	"pc", VS
	TEQ	r1, #0
	STRNE	r0, [r1]
	MOV	r0, #0
	Pull	"pc"

|uri_dispatch|
	Push	"r3-r5, lr"
	SWI	XURI_Dispatch
	Pull	"r3-r5, pc", VS
	ADD	r5, sp, #16
	LDMFD	r5, {r4-r5}
	TEQ	r5, #0
	STRNE	r3, [r5]
	TEQ	r4, #0
	STRNE	r2, [r4]
	Pull	"r3"
	TEQ	r3, #0
	STRNE	r0, [r3]
	MOV	r0, #0
	Pull	"r4-r5, pc"

|uri_request_uri|
	Push	"r4, lr"
	SWI	XURI_RequestURI
	Pull	"r4, pc", VS
	LDR	r4, [sp, #2*4]          ; Stacked APCS argument 4
	TEQ	r4, #0
	STRNE	r2, [r4]
	MOV	r0, #0
	Pull	"r4, pc"

|uri_invalidate_uri|
	Push	"lr"
	MOV	r3, r1
	SWI	XURI_InvalidateURI
	MOV	r0, #0
	Pull	"pc"

	END



