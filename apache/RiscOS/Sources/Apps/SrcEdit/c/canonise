#include "canonise.h"
#include <stdlib.h>
#include "swis.h"
#include <string.h>

int canonise_filenamebuffer(char* filename,int maxsize,const char* path)
{
   int size;
   char* fn;
 
   /* size is negative */
   if (_swix(OS_FSControl,_INR(0,5) | _OUT(5),37,filename,0,0,path,0,&size) || size==0 || -size>maxsize-1) return 0;

   fn = malloc(-size+1);
   if (!fn) return 0;

   _swix(OS_FSControl,_INR(0,5),37,filename,fn,0,path,-size+1);
   strcpy(filename,fn);

   free(fn);
   return 1;;
}
