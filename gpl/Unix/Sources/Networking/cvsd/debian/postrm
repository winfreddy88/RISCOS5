#!/bin/sh

set -e

case "$1" in
  purge)
    # offer to remove chroot jail (if configured and still exists)
    if [ -e /usr/share/debconf/confmodule ]
    then
      . /usr/share/debconf/confmodule
      db_get cvsd/rootjail
      if [ "$RET" != "" ] && [ "$RET" != "/" ] && [ "$RET" != "none" ] && [ -d "$RET" ]
      then
        CHROOT="$RET"
        db_title "Removing cvsd"
        db_subst cvsd/remove_chroot rootjail "$CHROOT"
        if db_input high cvsd/remove_chroot
        then
          db_go
          db_get cvsd/remove_chroot
          if [ "$RET" = "true" ]
          then
            rm -rf "$CHROOT"
          fi
        else
          echo "WARNING: not deleting $CHROOT!" >&2
        fi
      fi
    fi
    # remove config
    rm -rf /etc/cvsd
    # remove user/group
    userdel cvsd > /dev/null 2>&1 || true
    groupdel cvsd > /dev/null 2>&1 || true
    ;;
esac

#DEBHELPER#

exit 0
